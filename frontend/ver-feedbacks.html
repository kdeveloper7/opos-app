<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ver Feedbacks</title>
  <script defer>
    async function cargarTemas() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('No estás autenticado. Inicia sesión.');
        window.location.href = 'login.html';
        return;
      }

      const res = await fetch('http://localhost:3000/api/temas', {
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
      });

      if (!res.ok) {
        alert('Error al cargar los temas.');
        return;
      }
      const temas = await res.json();
      const select = document.getElementById('temaId');
      temas.forEach(t => {
        const option = document.createElement('option');
        option.value = t.id;
        option.textContent = t.titulo || `Tema sin título (${t.id})`;
        select.appendChild(option);
      });
    }

    async function verFeedbacks() {
      const temaId = document.getElementById('temaId').value;
      const token = localStorage.getItem('token');

      const res = await fetch(`http://localhost:3000/api/tema/${temaId}/feedbacks`, {
        headers: {
          'Authorization': 'Bearer ' + token
        }
      });

      if (!res.ok) {
        alert('Error al cargar los feedbacks.');
        return;
      }

      const feedbacks = await res.json();
      const container = document.getElementById('feedbacksContainer');
      if (feedbacks.length === 0) {
        container.innerHTML = '<p class="text-gray-600">No hay feedbacks para este tema.</p>';
        return;
      }

      container.innerHTML = feedbacks.map(fb => `
        <div class="border p-4 mb-4">
          <p><strong>${fb.username}:</strong> ${fb.comentario}</p>
        </div>
      `).join('');
    }

    document.addEventListener('DOMContentLoaded', cargarTemas);
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">
  <h1 class="text-2xl mb-4">Ver Feedbacks</h1>
  <div class="mb-4">
    <label for="temaId" class="block mb-1 font-medium text-gray-700">Selecciona un tema</label>
    <select id="temaId" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400" required>
      <option value="" disabled selected>-- Selecciona un tema --</option>
    </select>
    <button onclick="verFeedbacks()" class="bg-blue-500 text-white px-4 py-2 mt-2">Ver Feedbacks</button>
  </div>
  <div id="feedbacksContainer" class="space-y-4"></div>
  <a href="dashboard.html" class="text-blue-600 underline">Volver al Dashboard</a>
</body>
</html>
